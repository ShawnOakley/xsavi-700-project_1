<head>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<link rel="stylesheet" type="text/css" href="main.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.0.0/lodash.min.js"></script>

</head>

<body>
<div class="container-fluid">
	<div class="row">
	<div class="col-xs-2" id="select-menu"></div>
	<div class="col-xs-10" id="display-panel">
		<div id="text-box"></div>
		<div id="map"></div>
	</div>
	</div>
</div>

<script type="text/javascript">


// Should break down the LineStrings into two separate vectors, and then assign each different styles.
// Something to consider for animations:
// https://gis.stackexchange.com/questions/29885/animated-lines-and-line-styles-in-javascript
// https://dynmeth.github.io/RaphaelLayer/
// https://gis.stackexchange.com/questions/26546/openlayers-animation-examples-and-algorithms
// http://raphaeljs.com/

	function generateGeoJsonArray(mapDataStructures){
		var geoJsonArray = [];
		_.each(mapDataStructures, function(dataHash){
			var geoJsonHash = {};
			geoJsonHash["type"] = "LineString";
			geoJsonHash["coordinates"] = [[dataHash['home_marker']['coordinates'][1], dataHash['home_marker']['coordinates'][0]], [dataHash['intermediate_marker']['coordinates'][1], dataHash['intermediate_marker']['coordinates'][0]], [dataHash['final_marker']['coordinates'][1], dataHash['final_marker']['coordinates'][0]]];
			geoJsonArray.push(geoJsonHash);
		});
		return geoJsonArray;
	}
	var myStyle = {
	    "color": "#ff7800",
	    "weight": 5,
	    "opacity": 0.65
	};

	var mapDataStructures = [
		{	title: "default",
			type: 'LineString',
			home_marker : {
				coordinates: [40.7163670,-73.9548030],
				message : "<b>This is my apartment, where I watched the show.</b>"
			},
			intermediate_marker : {
				coordinates: [40.7590110,-73.9844720],
				message : "<b>This is Times Square.</b>"
			},
			final_marker : {
				coordinates: [40.7728940,-73.9484880],
				message : "<b>This is Times Square.</b>"
			}
		}
	];

	var testFlight = generateGeoJsonArray(mapDataStructures);
	console.log(testFlight);

	var map = L.map('map').setView([40.7163670,-73.9548030], 13);
	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
	    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
	    maxZoom: 18,
	    id: 'mapbox.satellite',
	    accessToken: 'pk.eyJ1Ijoic2hhd25vYWtsZXkiLCJhIjoiY2lqbTkzeGlrMDBhdXVmbHg0Z2Zzczl1YiJ9.rdTmbpwH0YTdD79RfXCd7w'
	}).addTo(map);

	L.geoJson(testFlight, {
	    style: myStyle
	}).addTo(map);
	setTimeout(function(){
		var home_marker = L.marker([40.7163670,-73.9548030]).addTo(map);
		home_marker.bindPopup("<b>This is my apartment, where I watched the show.</b>").openPopup();
	},750);
	setTimeout(function(){
		var intermediate_marker = L.marker([40.7590110,-73.9844720]).addTo(map);
		intermediate_marker.bindPopup("<b>This is Times Square.</b>").openPopup();
	},1500);
	setTimeout(function(){
		var final_marker = L.marker([40.7728940,-73.9484880]).addTo(map);
		final_marker.bindPopup("<b>This is where I used to live.</b>").openPopup();
	},3000);

</script>
</body>

